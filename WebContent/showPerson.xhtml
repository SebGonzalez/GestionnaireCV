<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">


<ui:composition template="/template/mylayout.xhtml">
	<ui:define name="content">
		<div class="center">
			<img src="univam.png" name="amu" style="height: 200px;" />
		</div>

		<c:set var="p" value="#{gestionnairec.personne}" />

		<div id="garde">
			<p:button outcome="persons" value="Liste des personnes">
			</p:button>
		</div>
		<div class="jumbotron">
			<h:form id="infos">
				<c:if test="#{login.getEdition() == false or p.id != login.user.id}">
					<h2>#{messages.person} #{p.name} #{p.firstName}</h2>
					<p>#{messages.id} #{p.id}</p>
					<p>#{messages.mail} #{p.mail}</p>
					<p>#{messages.website} #{p.site}</p>
					<p>
						#{messages.birthday}
						<h:outputText value="#{p.birthDay}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p>
				</c:if>
				<c:if test="#{login.getEdition() and p.id == login.user.id}">
					<h:panelGrid id="grid" columns="3" cellpadding="5">
						<p:outputLabel for="name" value="Nom :" />
						<p:inputText class="une" id="name" value="#{p.name}"
							required="true" />
						<p:message for="name" />


						<p:outputLabel for="firstname" value="Prénom :" />
						<p:inputText class="une" id="firstname" value="#{p.firstName}"
							required="true" />
						<p:message for="firstname" />

						<p:outputLabel for="mail" value="Mail :" />
						<p:inputText class="une" id="mail" value="#{p.mail}"
							required="true" />
						<p:message for="mail" />

						<p:outputLabel for="site" value="Site web :" />
						<p:inputText class="une" id="site" value="#{p.site}"
							required="true">
							<f:validator for="site" validatorId="myconstraints.Website" />
							<f:ajax event="keyup" render="msite" />
						</p:inputText>
						<p:message id="msite" for="site" />

						<p:outputLabel for="birthDay" value="Date de naissance : " />
						<p:calendar class="une" id="birthDay" value="#{p.birthDay}"
							showOn="both" navigator="true" pattern="dd/MM/yyyy"
							defaultHour="1" mindate="01/01/1950" maxdate="31/12/2020" yearRange="c-100:c+100"/>
						<p:message for="birthDay" />
					</h:panelGrid>
					<br></br>

					<div style="margin-top: 5%; text-align: center; margin-left: -45%;">
						<p:commandButton class="submit" value="Sauvegarder"
							action="#{gestionnairec.savePerson(p)}" update="infos editButton">
						</p:commandButton>

					</div>
				</c:if>

			</h:form>
			<h:form id="editButton" class="center">
				<c:if test="#{p.id == login.user.id and login.edition == false}">
					<p>
						<p:commandButton value="Editer les infos"
							action="#{login.changeEdition}" update="infos editButton">

						</p:commandButton>

						<p:commandButton value="Cooptation"
							action="#{gestionnairec.createPerson()}"
							update="infos editButton">
						</p:commandButton>
					</p>
				</c:if>
			</h:form>
		</div>

		<div class="jumbotron" id="infos">
			<h2>CV</h2>
			<h:form id="form">
				<p:growl id="msgs" showDetail="true" />

				<p:dataTable value="#{p.cv.activities}" var="a" id="cv"
					editable="true" style="margin-bottom:20px"
					selection="#{gestionnairec.selectedActivity}"  selectionMode="single" rowKey="#{a.id}">
					<f:facet name="header">
					#{messages.listeActivite}
					</f:facet>
					<!-- 					<p:ajax event="rowSelect" -->
					<!-- 						listener="#{gestionnairec.onActivitySelected}" -->
					<!-- 						update=":form:activityDetail" /> -->
					<p:ajax event="rowEdit" listener="#{gestionnairec.onRowEdit}"
						update=":form:msgs" />
					<p:ajax event="rowEditCancel"
						listener="#{gestionnairec.onRowCancel}" update=":form:msgs" />
					<p:column headerText="Titre">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.title}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText id="modelInput" value="#{a.title}"
									style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Année">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.year}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{a.year}" style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Nature">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.nature}" />
							</f:facet>
							<f:facet name="input">
								<h:selectOneMenu value="#{a.nature}" style="width:100%">
									<f:selectItems value="#{gestionnairec.natures}" var="nature"
										itemLabel="#{nature}" itemValue="#{nature}" />
								</h:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Description">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.description}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{a.description}" style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Site">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.website}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{a.website}" style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>


					<p:column style="width:32px" rendered="#{p.id == login.user.id}">
						<p:rowEditor />
					</p:column>

					<f:facet name="footer">
						<p:commandButton process="form" update=":form:activityDetail"
							icon="pi pi-search" value="View"
							oncomplete="PF('activityDialog').show()"
							style="padding:.2em 1.1em .2em .0em;" />
					</f:facet>
				</p:dataTable>

				<p:dialog header="Infomation activité" widgetVar="activityDialog"
					modal="true" showEffect="fade" hideEffect="fade" resizable="false">
					<p:outputPanel id="activityDetail" style="text-align:center;">

						<p:panelGrid columns="2" columnClasses="label,value">
							<h:outputText value="Titre :" />
							<h:outputText value="#{gestionnairec.selectedActivity.title}" />

							<h:outputText value="Année :" />
							<h:outputText value="#{gestionnairec.selectedActivity.year}" />

							<h:outputText value="Nature :" />
							<h:outputText value="#{gestionnairec.selectedActivity.nature}" />

							<h:outputText value="Description :" />
							<h:outputText
								value="#{gestionnairec.selectedActivity.description}" />

							<h:outputText value="Site web :" />
							<h:outputText value="#{gestionnairec.selectedActivity.website}" />

							<h:outputText value="Personne :" />
							<h:outputText
								value="#{gestionnairec.selectedActivity.owner.name}" />
						</p:panelGrid>

					</p:outputPanel>
				</p:dialog>
			</h:form>

			<h:form id="addActivity">
				<c:set var="a" value="#{gestionnairec.createdActivity}" />
				<c:if test="#{gestionnairec.creationActivity == false}">
					<p:commandButton value="Ajouter une activité"
						styleClass="ui-priority-primary" update="@form"
						action="#{gestionnairec.onAddNewActivity()}" />
				</c:if>
				<c:if test="#{gestionnairec.creationActivity}">
					<h:panelGrid id="grid" columns="5" cellpadding="5">
						<p:outputLabel for="titre" value="Titre : " />
						<p:outputLabel for="year" value="Year : " />
						<p:outputLabel for="nature" value="Nature : " />
						<p:outputLabel for="description" value="Description : " />
						<p:outputLabel for="site" value="Site : " />


						<p:inputText id="titre" value="#{a.title}" required="true"></p:inputText>
						<h:inputText id="year" value="#{a.year}" required="true">
<!-- 							<f:validateLongRange minimum="1950" maximum="2020" /> -->
						</h:inputText>
						<p:selectOneMenu id="nature" value="#{a.nature}"
							style="width:125px" required="true">
							<f:selectItems value="#{gestionnairec.natures}" />
						</p:selectOneMenu>

						<p:inputText id="description" value="#{a.description}"></p:inputText>
						<p:inputText id="site" value="#{a.website}">
							<f:validator for="site" validatorId="myconstraints.Website" />
							<f:ajax event="keyup" render="msite" />
						</p:inputText>

						<p:message for="titre" />
						<p:message for="year" />
						<p:message for="nature" />
						<p:message for="description" />
						<p:message id="msite" for="site" />

					</h:panelGrid>
					<p:commandButton value="Valider"
						action="#{gestionnairec.createActivity()}"
						update="addActivity form" oncomplete="PF('cv').addRow();">
					</p:commandButton>

					<p:commandButton value="Annuler"
						action="#{gestionnairec.cancelActivity()}" update="addActivity">
					</p:commandButton>
				</c:if>
			</h:form>
		</div>
	</ui:define>
</ui:composition>

</html>