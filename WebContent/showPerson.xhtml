<?xml version="1.0" encoding="UTF-8" ?>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui">


<ui:composition template="/template/mylayout.xhtml">
	<ui:define name="content">



		<c:set var="p" value="#{gestionnairec.personne}" />
		<div class="jumbotron">
			<h:form id="infos">
				<c:if test="#{login.getEdition() == false or p.id != login.user.id}">
					<h2>Personne #{p.name} #{p.firstName}</h2>
					<p>Id: #{p.id}</p>
					<p>Mail: #{p.mail}</p>
					<p>Site web : #{p.site}</p>
					<p>
						Date de naissance :
						<h:outputText value="#{p.birthDay}">
							<f:convertDateTime pattern="dd/MM/yyyy" />
						</h:outputText>
					</p>
				</c:if>
				<c:if test="#{login.getEdition() and p.id == login.user.id}">

					<h2>Personne</h2>
					<h:inputText id="name" value="#{p.name}"></h:inputText>
					<h:inputText id="firstname" value="#{p.firstName}"></h:inputText>
					<br></br>
					<h:outputText value="Mail :" />
					<h:inputText id="mail" value="#{p.mail}"></h:inputText>
					<br></br>
					<h:outputText value="Site web :" />
					<h:inputText id="site" value="#{p.site}"></h:inputText>
					<br></br>
					<h:outputText for="birthDay" value="Date de naissance : " />
					<p:calendar id="birthDay" value="#{p.birthDay}" showOn="both"
						navigator="true" pattern="dd/MM/yyyy" defaultHour="1" />
					<br></br>

					<p:commandButton value="Sauvegarder"
						action="#{gestionnairec.savePerson(p)}" update="infos editButton">
					</p:commandButton>

				</c:if>

			</h:form>
			<h:form id="editButton">
				<c:if test="#{p.id == login.user.id and login.edition == false}">
					<p>
						<p:commandButton value="Editer les infos"
							action="#{login.changeEdition}" update="infos editButton">

						</p:commandButton>

						<p:commandButton value="Cooptation"
							action="#{gestionnairec.createPerson()}"
							update="infos editButton">
						</p:commandButton>
					</p>
				</c:if>
			</h:form>
		</div>

		<div class="jumbotron">
			<h2>CV</h2>
			<h:form id="form">
				<p:growl id="msgs" showDetail="true" />

				<p:dataTable value="#{p.cv.activities}" var="a" id="cv"
					selectionMode="single" editable="true" style="margin-bottom:20px"
					selection="#{gestionnairec.selectedActivity}" rowKey="#{a.id}">
					<f:facet name="header">
					Liste des activités
					</f:facet>
					<!-- 					<p:ajax event="rowSelect" -->
					<!-- 						listener="#{gestionnairec.onActivitySelected}" -->
					<!-- 						update=":form:activityDetail" /> -->
					<p:ajax event="rowEdit" listener="#{gestionnairec.onRowEdit}"
						update=":form:msgs" />
					<p:ajax event="rowEditCancel"
						listener="#{gestionnairec.onRowCancel}" update=":form:msgs" />
					<p:column headerText="Titre">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.title}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText id="modelInput" value="#{a.title}"
									style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Année">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.year}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{a.year}" style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Nature">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.nature}" />
							</f:facet>
							<f:facet name="input">
								<h:selectOneMenu value="#{a.nature}" style="width:100%">
									<f:selectItems value="#{gestionnairec.natures}" var="nature"
										itemLabel="#{nature}" itemValue="#{nature}" />
								</h:selectOneMenu>
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Description">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.description}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{a.description}" style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>
					<p:column headerText="Site">
						<p:cellEditor>
							<f:facet name="output">
								<h:outputText value="#{a.website}" />
							</f:facet>
							<f:facet name="input">
								<p:inputText value="#{a.website}" style="width:100%" />
							</f:facet>
						</p:cellEditor>
					</p:column>


					<p:column style="width:32px" rendered="#{p.id == login.user.id}">
						<p:rowEditor />
					</p:column>
					<f:facet name="footer">
						<p:commandButton process="form" update=":form:activityDetail"
							icon="pi pi-search" value="View"
							oncomplete="PF('activityDialog').show()" />
					</f:facet>
				</p:dataTable>

				<p:dialog header="Infomation activité" widgetVar="activityDialog"
					modal="true" showEffect="fade" hideEffect="fade" resizable="false">
					<p:outputPanel id="activityDetail" style="text-align:center;">

						<p:panelGrid columns="2" columnClasses="label,value">
							<h:outputText value="Titre :" />
							<h:outputText value="#{gestionnairec.selectedActivity.title}" />

							<h:outputText value="Année :" />
							<h:outputText value="#{gestionnairec.selectedActivity.year}" />

							<h:outputText value="Nature :" />
							<h:outputText value="#{gestionnairec.selectedActivity.nature}" />

							<h:outputText value="Description :" />
							<h:outputText
								value="#{gestionnairec.selectedActivity.description}" />

							<h:outputText value="Site web :" />
							<h:outputText value="#{gestionnairec.selectedActivity.website}" />

							<h:outputText value="Personne :" />
							<h:outputText
								value="#{gestionnairec.selectedActivity.owner.name}" />
						</p:panelGrid>

					</p:outputPanel>
				</p:dialog>
			</h:form>

			<h:form id="addActivity">
				<c:set var="a" value="#{gestionnairec.createdActivity}" />
				<c:if test="#{gestionnairec.creationActivity == false}">
					<p:commandButton value="Ajouter une activité"
						styleClass="ui-priority-primary" update="@form"
						action="#{gestionnairec.onAddNewActivity()}" />
				</c:if>
				<c:if test="#{gestionnairec.creationActivity}">
					<h:panelGrid id="grid" columns="5" cellpadding="5">
						<p:outputLabel for="titre" value="Titre : " />
						<p:outputLabel for="year" value="Year : " />
						<p:outputLabel for="nature" value="Nature : " />
						<p:outputLabel for="description" value="Description : " />
						<p:outputLabel for="site" value="Site : " />


						<p:inputText id="titre" value="#{a.title}" required="true"></p:inputText>
						<p:inputText id="year" value="#{a.year}"></p:inputText>
						<p:selectOneMenu id="nature" value="#{a.nature}"
							style="width:125px">
							<f:selectItems value="#{gestionnairec.natures}" />
						</p:selectOneMenu>

						<p:inputText id="description" value="#{a.description}"></p:inputText>
						<p:inputText id="site" value="#{a.website}"></p:inputText>
						
						<p:message for="titre" />
						<p:message for="year" />
						<p:message for="nature" />
						<p:message for="description" />
						<p:message for="site" />

					</h:panelGrid>
					<p:commandButton value="Valider"
						action="#{gestionnairec.createActivity()}"
						update="addActivity form" oncomplete="PF('cv').addRow();">
					</p:commandButton>
					
					<p:commandButton value="Annuler"
						action="#{gestionnairec.cancelActivity()}"
						update="addActivity">
					</p:commandButton>
				</c:if>
			</h:form>
		</div>

		<div class="jumbotron">
			<p:button outcome="persons" value="Liste des personnes">
			</p:button>
		</div>
	</ui:define>
</ui:composition>

</html>